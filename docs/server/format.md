# フォーマットについて

## 概要

本ミッションでは，子機は基本的にサーバーのように動作します．
もちろんネットワークはインターネットのようなものではなく IM920 による通信網であり，クライアントは親機または管制局です．

子機には IM920 を使って様々なコマンドを送れるようにします．
子機は受け取ったコマンドに応じて処理を行い，コマンドによってはレスポンスを返すことが出来ます．
一方，親機はミッション中に子機にコマンドを送り，そのレスポンスをもらいながらミッションを効果的に進めることが出来ます．

コマンドは単に送っただけでは意味がありません．
送ったコマンドは受信側で正しく解釈される必要があります．
そのためには，送信情報がコマンドを含む一定フォーマットに則っていなければなりません．
以下では，そのフォーマットを定義します．


## リクエストのフォーマット

基本的なリクエストのフォーマットは

```
$(受付番号)(コマンド名)(アドレス)$(各引数の byte 数)$(引数1)(引数2)...
```

とします．
メインのセパレータとしては **$** を使用します．

受付番号およびコマンド名は固定長なので，($ も含む) 先頭の4 byte をヘッド (head) と呼ぶことにします．

### 受付番号 (固定長 1 byte)

受付番号は1 byte (8 bit) からなります．
受付番号はクライアント側が設定できる任意の番号です．
サーバーはクライアントからリクエストを受け，その処理を実行し，レスポンスにクライアントから受け取った受付番号をそのまま添付して返します．
そして，それを受け取ったクライアントはその受付番号からどのリクエストに対するレスポンスかを判断することが出来ます．

レスポンスの速い通常のサーバーに受付番号などというものはいりませんが，子機はサーバーとしての性能は優れていないため，レイテンシの問題に対処するために受付番号を導入しました．

### コマンド名 (固定長 2 byte)

コマンド名は英数字2文字とします．
つまり，使える文字は 0 ~ 9, a ~ z, A ~ Z であり，3844通りのコマンドを設定できます．

### アドレス (任意長)

アドレスは pisat.comm.transceiver.TransceiverBase を継承したオブジェクトの送信側のアドレスです．
Transceiver オブジェクトのアドレスは一般にタプルで表現されますが，(arg1, arg2, ..., argN) で表現されるアドレスは

```
arg1:arg2:...:argN
```

とセミコロンで区切って表現します．

### 各引数の byte 数 (任意長)

byte 数は16進数で表現します．
その長さに制限はありません．
複数の引数がある場合，

```
(引数1の byte 数):(引数2の byte 数):...:(引数Nの byte 数)
```

と表現します．

これは任意のバイトを含む引数を処理するために必要な情報です．

### 引数 (任意長)

引数には特に制限はありません．
一般に引数は複数存在しますが，各引数はセパレータなしにそのまま結合されます．


## レスポンスのフォーマット

レスポンスのフォーマットはリクエストとほぼ同じです．
ただし以下の点が異なります．

- コマンドが **FF** で固定
- 引数の代わりに結果が返ってくる
