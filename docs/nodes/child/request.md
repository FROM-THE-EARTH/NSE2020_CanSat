# 子機のコマンドについて

## 概要

子機は基本的にサーバーのように動作する．
もちろんネットワークは IM920 による通信網であり，クライアントは親機または管制局である．

子機には IM920 を使って様々なコマンドを送れるようにする．
子機は受け取ったコマンドに応じて処理を行い，コマンドによってはレスポンスを返す．


## 用語の定義

### クライアント

サーバーにある決まったデータを送りお願い事をする側のこと．

### リクエスト

クライアントがサーバーへ送るデータ．

### コマンド名

サーバーにやってもらう処理を識別するための文字列．
リクエストに含まれる．
処理についての意味合いを強めるときには単にコマンドと呼ぶことにする．


## リクエストのフォーマット

基本的なリクエストのフォーマットは

```
$(状態信号)(コマンド名)(アドレス)$(各引数の byte 数)$(引数1)(引数2)...
```

とする．
セパレータとしては **$** を用いる．

状態信号およびコマンド名は固定長なので，($ も含む) 頭の4 byte をヘッド (head) と呼ぶことにする．

### 状態信号 (固定長 1 byte)

状態信号は1 byte (8 bit) からなる．
その内訳は

```
(SCビット 1 bit)(受付番号 7 bit)
```

SCビットはサーバー側 (レスポンス) が0，クライアント側 (リクエスト) が1とする．

受付番号はクライアント側が設定できる任意の番号である．
サーバーはクライアントからリクエストを受け，その処理を実行し，レスポンスにクライアントから受け取った受付番号をそのまま添付して返す．
そして，それを受け取ったクライアントはその受付番号からどのリクエストに対するレスポンスかを判断する．
レスポンスの速い通常にサーバーに受付番号などというものはいらないが，子機はサーバーとしての性能は優れていないため，レイテンシの問題に対処するために受付番号を導入した．

### コマンド名 (固定長 2 byte)

コマンド名は英数字2文字とする．
つまり，使える文字は 0 ~ 9, a ~ z, A ~ Z であり，3844通りのコマンドを設定できる．

### アドレス (任意長)

アドレスは Transceiver オブジェクトのアドレスである．
Transceiver オブジェクトのアドレスはタプルで表現されるが，(arg1, arg2, ..., argN) で表現されるアドレスは

```
arg1:arg2:...:argN
```

とセミコロンで区切って表現する．

### 各引数の byte 数 (任意長)

byte 数は16進数で表現する．
長さに制限はない．
これは任意のバイトを含む引数を処理するために必要な情報である．

### 引数 (任意長)

引数には特に制限はない．


## コマンドの種類

### プログラムを終了させる

### 
